---
title: Hunting the Outlook Zero-Click Exploit
time: 2025-04-27
categories: [forensic]
tags: [wireshark, easy, CVE-2023-23397]
image: /assets/posts/chall_category/forensic.jpg
---

### Description:

Your team has been alerted to suspicious activity on the corporate network. An attacker exploited CVE-2023-23397, a critical Microsoft Outlook vulnerability, to silently steal NTLM credentials from an employee's workstation. The attacker used a malicious calender invite to force an authentication attempt to a rogue SMB server. 

Your task is to analyze the PCAP file of this incident. You are required to extract the captured NTLM hash and identify the compromised password, confirm whether is the password part of rockyou.txt wordlist. 

- Category: forensic
- **Flag format:** CTF{plaintext-password-from-NTLM-hash} 

<button onclick="downloadFile()">Download File</button>

<script>
function downloadFile() {
    const link = document.createElement('a');
    link.href = 'https://github.com/0x251e-challenge/challenges/raw/refs/heads/main/union-depository/forensic/hunting-outlook-zero-click-exploit/ntlm-leak.pcapng';
    link.download = 'mail-server-localhost.pcapng';
    link.click();
}
</script>

### Solution:

##### 1. Analyze pcap file with wireshark
There are two information we need to know from the pcap:
- Identify endpoint of the victim IP address
- Check NTLMSSP protocol with protocol hierarchy

![image1.png](/assets/posts/chall-writeup-img/hunting-the-outlook-zero-click-exploit/img1.png)

By analyzing the conversation from each endpoint, we can notice two endpoints that transferred 22 packets. Next we use this information as filter along with NTLMSSP protocol.
With this Wireshark filter: `ip.addr==192.168.56.101 && ip.addr==192.168.56.102 && ntlmssp`, we can narrow down and find out the NTLM challenge response packet. 

![image2.png](/assets/posts/chall-writeup-img/hunting-the-outlook-zero-click-exploit/img2.png)

Notice that it shows all three NTLM authentication process (NEGOTIATE, CHALLENGE and AUTHENTICATE) packets. 

##### 2. Use NTLMRawUnHide tool to extract NTLM hash
[NTLMRawUnHide](https://github.com/mlgualtieri/NTLMRawUnHide) is a tool to parse pcap and extract NTLMv2 hashes. After running the tools on the pcap, here is the result:

```bash
Searching ../ntlm-leak.pcapng for NTLMv2 hashes...

Found NTLMSSP Message Type 1 : Negotiation

Found NTLMSSP Message Type 2 : Challenge
    > Server Challenge       : 6ca95c19d3da7e96 

Found NTLMSSP Message Type 3 : Authentication
    > Domain                 : DESKTOP-B2E8BNS 
    > Username               : FlareVM 
    > Workstation            : DESKTOP-B2E8BNS 

NTLMv2 Hash recovered:
FlareVM::DESKTOP-B2E8BNS:6ca95c19d3da7e96:e1fe4b7c7cdaf8ff9b246a3123c4d1a1:0101000000000000800ce7a2d2b6db01c72ec36ea1a7ac4c00000000020008003700520038004b0001001e00570049004e002d0055003800360044005300370058004d0035003000390004003400570049004e002d0055003800360044005300370058004d003500300039002e003700520038004b002e004c004f00430041004c00030014003700520038004b002e004c004f00430041004c00050014003700520038004b002e004c004f00430041004c0007000800800ce7a2d2b6db0106000400020000000800300030000000000000000000000000300000f9994a49444dc4165f1392f6c3844b71981f2347228f2f3ba63abd0d810343720a001000000000000000000000000000000000000900260063006900660073002f003100390032002e003100360038002e00350036002e003100300032000000000000000000
```

We have successfully extract the hash, next we can save the hash into a text file so that it can be used to crack with `rockyou.txt`. 

##### 3. Use hashcat or john to crack the hash

![image3.png](/assets/posts/chall-writeup-img/hunting-the-outlook-zero-click-exploit/img3.png)
The plaintext password is `password1`.

**FLAG:** `CTF{password1}`

### About CVE-2023-23397: 

